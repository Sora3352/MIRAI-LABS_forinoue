<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>カートの内容 | E-Mart</title>
    <!-- Load Tailwind CSS for modern, responsive styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for appearance */
        .shadow-cart {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
        }
        .cart-item-image {
            width: 120px;
            height: 120px;
            object-fit: contain;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
        }
        .quantity-button {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #ccc;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.1s;
        }
        .quantity-button:hover {
            background-color: #f0f0f0;
        }
        .buy-button {
            background-color: #ff9900; 
            transition: background-color 0.15s;
        }
        .buy-button:hover {
            background-color: #e68a00;
        }
        .quantity-input {
            width: 40px;
            text-align: center;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin: 0 4px;
            height: 28px; /* Match button height */
        }
        /* Hide the default spinner for number inputs */
        input[type='number']::-webkit-inner-spin-button, 
        input[type='number']::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
        input[type='number'] { 
            -moz-appearance: textfield; 
        }
        /* Style for the custom modal backdrop */
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.5);
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'emart-orange': '#ff9900', 
                        'emart-summary-bg': '#f8f8f8', 
                    }
                }
            }
        }

        // --- GLOBAL STATE ---
        let cartItems = []; 
        let nextItemId = 3;

        // --- MOCK DATA STRUCTURE (With 'selected' flag) ---
        const MOCK_CART_ITEMS = [
            { id: 1, name: 'Lenovo V15 Gen 5 スタンダード', sku: 431135, price: 250000, quantity: 1, deliveryDate: '10月18日', imageUrl: 'data:image/webp;base64,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', selected: true },
            { id: 2, name: 'Samsung S25 Ultra 256GB', sku: 431139, price: 209000, quantity: 2, deliveryDate: '10月17日', imageUrl: 'https://encrypted-tbn0.gstatic.com/shopping?q=tbn:ANd9GcQkE9dmF0h-De0G145BKMbxFE1oJkznErZOFFId4MJiJ88o_tGl9CF2lUuIV9wRSduYNp4hYj3Fynps3jN1MuwGwSf6Ap_TlRnnR1AXuOAs1gxLfazt3e9VgGUjukEwdbEnHbufpf0&usqp=CAc', selected: true }
        ];

        /**
         * Renders the cart content based on the current global state (cartItems).
         */
        function renderCart() {
            const emptyDiv = document.getElementById('empty-cart-message');
            const fullDiv = document.getElementById('full-cart-content');
            const itemsContainer = document.getElementById('cart-items-container');

            itemsContainer.innerHTML = ''; // Clear existing items

            if (cartItems.length === 0) {
                // Show Empty Cart Message
                emptyDiv.classList.remove('hidden');
                fullDiv.classList.add('hidden');
            } else {
                // Show Full Cart Content
                emptyDiv.classList.add('hidden');
                fullDiv.classList.remove('hidden');

                cartItems.forEach(item => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'flex flex-col sm:flex-row pb-6 pt-4 border-b border-gray-200 last:border-b-0';
                    // Use a dataset attribute to store item ID for easy deletion/manipulation later
                    itemDiv.dataset.itemId = item.id; 
                    itemDiv.innerHTML = `
                        <div class="flex-shrink-0 mr-6 mb-4 sm:mb-0 flex items-start">
                            <!-- Checkbox: Calls toggleSelection on change -->
                            <input type="checkbox" id="check-${item.id}" ${item.selected ? 'checked' : ''} 
                                onclick="toggleSelection(${item.id})" class="w-5 h-5 text-emart-orange border-gray-300 rounded focus:ring-emart-orange mt-1 cursor-pointer">
                            <img src="${item.imageUrl}" onerror="this.onerror=null;this.src='https://placehold.co/120x120/cccccc/333333?text=No+Image';" alt="${item.name}" class="cart-item-image ml-4">
                        </div>
                        
                        <div class="flex-grow">
                            <p class="text-base text-gray-700 font-bold mb-1">¥${item.price.toLocaleString()}</p>
                            <p class="text-lg font-semibold text-gray-900">${item.name}</p>
                            <p class="text-xs text-gray-500 mb-2">品番: ${item.sku}</p>
                            
                            <div class="flex items-center text-sm text-gray-500 mb-3">
                                <span class="font-bold mr-2 text-xs">無料配送</span> 
                                <span class="text-xs">${item.deliveryDate}</span>
                            </div>
                            
                            <!-- Item Actions -->
                            <div class="flex items-center space-x-2">
                                <!-- Quantity Controls -->
                                <div class="flex items-center">
                                    <button onclick="updateQuantity(${item.id}, -1)" class="quantity-button text-xl">
                                        &minus;
                                    </button>
                                    <input type="number" id="qty-input-${item.id}" value="${item.quantity}" min="1" 
                                        onchange="handleManualQuantity(${item.id})" class="quantity-input text-sm">
                                    <button onclick="updateQuantity(${item.id}, 1)" class="quantity-button text-xl">
                                        +
                                    </button>
                                </div>
                                
                                <!-- Delete Button -->
                                <button class="text-sm font-medium bg-black text-white px-2 py-1 rounded-sm hover:bg-gray-800" onclick="removeItem(${item.id})">
                                    削除
                                </button>
                                <!-- Add to Favorites Button -->
                                <button class="text-sm font-medium text-emart-orange hover:underline" onclick="toggleFavorite(${item.id}, '${item.name}')">
                                    お気に入りに追加
                                </button>
                            </div>
                        </div>
                    `;
                    itemsContainer.appendChild(itemDiv);
                });

                // Calculate and update the summary after rendering all items
                recalculateSummary();
            }
        }

        /**
         * Recalculates the total items and price, only including SELECTED items.
         */
        function recalculateSummary() {
            let totalItems = 0;
            let totalPrice = 0;
            
            // Iterate only over items that are currently marked as selected
            cartItems.forEach(item => {
                if (item.selected) {
                    totalItems += item.quantity;
                    totalPrice += item.price * item.quantity;
                }
            });

            document.getElementById('summary-items').textContent = `${totalItems} 点`;
            document.getElementById('summary-total').textContent = `¥${totalPrice.toLocaleString()}`;

            // Disable checkout button if total is 0
            const checkoutButton = document.getElementById('checkout-button');
            if (checkoutButton) {
                if (totalItems > 0) {
                    checkoutButton.classList.remove('opacity-50', 'cursor-not-allowed');
                    checkoutButton.disabled = false;
                } else {
                    checkoutButton.classList.add('opacity-50', 'cursor-not-allowed');
                    checkoutButton.disabled = true;
                }
            }
        }

        // --- INTERACTION HANDLERS ---

        /**
         * Shows a temporary, non-disruptive confirmation message.
         * @param {string} message - The message to display.
         */
        function showToast(message) {
            const toast = document.getElementById('toast-message');
            toast.textContent = message;
            toast.classList.remove('hidden', 'opacity-0');
            toast.classList.add('opacity-100');
            
            // Hide after 3 seconds
            setTimeout(() => {
                toast.classList.remove('opacity-100');
                toast.classList.add('opacity-0');
                // Use a short delay before hiding completely to allow fade-out
                setTimeout(() => {
                    toast.classList.add('hidden');
                }, 300);
            }, 3000);
        }

        /**
         * Updates the quantity of an item in the state.
         * @param {number} itemId - The ID of the item to update.
         * @param {number} delta - +1 or -1 to adjust the quantity.
         */
        function updateQuantity(itemId, delta) {
            const item = cartItems.find(i => i.id === itemId);
            if (item) {
                let newQuantity = item.quantity + delta;
                
                // Ensure quantity is 1 or greater
                if (newQuantity < 1) {
                    newQuantity = 1;
                }
                
                // 1. Update the local JavaScript state
                item.quantity = newQuantity;
                
                // 2. Update the HTML input box (must be done manually since we didn't re-render everything)
                const inputElement = document.getElementById(`qty-input-${itemId}`);
                if (inputElement) {
                    inputElement.value = newQuantity;
                }

                // 3. Recalculate and update the summary panel
                recalculateSummary();
            }
        }
        
        /**
         * Handles manual quantity changes in the input box.
         * @param {number} itemId - The ID of the item to update.
         */
        function handleManualQuantity(itemId) {
            const inputElement = document.getElementById(`qty-input-${itemId}`);
            if (!inputElement) return;

            // Get new quantity, ensure it's a number and at least 1
            let newQuantity = parseInt(inputElement.value) || 1;
            
            if (newQuantity < 1) {
                newQuantity = 1;
                inputElement.value = 1; // Correct the displayed value
            }

            // 1. Update the local JavaScript state
            const item = cartItems.find(i => i.id === itemId);
            if (item) {
                item.quantity = newQuantity;
            }

            // 2. Recalculate and update the summary panel
            recalculateSummary();
        }


        /**
         * Toggles the selection status of an item.
         * @param {number} itemId - The ID of the item to update.
         */
        function toggleSelection(itemId) {
            const item = cartItems.find(i => i.id === itemId);
            if (item) {
                item.selected = !item.selected;
                // Since only the summary is affected, we only need to recalculate
                recalculateSummary(); 
            }
        }

        /**
         * Removes the item from the cart state and re-renders.
         * @param {number} itemId - The ID of the item to remove.
         */
        function removeItem(itemId) {
            // Filter out the item to remove
            cartItems = cartItems.filter(item => item.id !== itemId);
            
            // Re-render the entire cart since the structure changed
            renderCart();

            showToast('カートから商品を削除しました。');
        }

        /**
         * Placeholder for adding an item to a favorites list.
         */
        function toggleFavorite(itemId, itemName) {
            // In a real app, this would make an API call to add to a separate list.
            showToast(`${itemName}をお気に入りに追加しました！`);
        }

        /**
         * Placeholder for starting the checkout process.
         */
        function handleCheckout() {
             const selectedItems = cartItems.filter(item => item.selected);
             if (selectedItems.length === 0) {
                 showToast('チェックアウトするには少なくとも1つの商品を選択してください。');
                 return;
             }

             // Show the confirmation modal (replacing alert())
             const totalAmount = document.getElementById('summary-total').textContent;
             const message = `選択された ${selectedItems.length} 点 (${totalAmount}) を注文処理に進めます。`;
             
             document.getElementById('modal-title').textContent = '確認';
             document.getElementById('modal-body').innerHTML = `<p>${message}</p><p class="mt-3 text-sm text-gray-500">（このデモでは、実際の注文は行いません）</p>`;
             document.getElementById('modal-container').classList.remove('hidden');
        }

        /**
         * Closes the confirmation modal.
         */
        function closeModal() {
            document.getElementById('modal-container').classList.add('hidden');
        }


        window.onload = () => {
             // Initial render with NO items (default empty state)
             renderCart([]);

             // --- Test Button Logic ---
             const testButton = document.getElementById('test-toggle-button');
             let isCartEmpty = true;
             if (testButton) {
                 testButton.onclick = () => {
                    isCartEmpty = !isCartEmpty;
                    
                    // Use a deep copy of mock data to ensure changes (like quantity) don't persist between toggles
                    // and resets the state to the original mock setup.
                    cartItems = isCartEmpty ? [] : JSON.parse(JSON.stringify(MOCK_CART_ITEMS)); 
                    
                    // Re-render based on the new cartItems state
                    renderCart(); 
                    
                    testButton.textContent = isCartEmpty ? 
                        '>> Full Cart Preview (クリックして機能を確認)' : '<< Empty Cart Preview';
                 };
             }
        };
        
    </script>
</head>
<body class="bg-white min-h-screen font-sans">

    <!-- Modal Container (Hidden by default) -->
    <div id="modal-container" class="hidden fixed inset-0 z-50 overflow-y-auto modal-backdrop flex items-center justify-center">
        <div class="relative bg-white rounded-lg shadow-xl w-full max-w-md mx-4 p-6 transform transition-all">
            <h3 id="modal-title" class="text-lg leading-6 font-bold text-gray-900 border-b pb-2 mb-4">確認</h3>
            <div id="modal-body" class="mt-2 text-sm text-gray-700">
                <!-- Content injected here -->
            </div>
            <div class="mt-4 text-right">
                <button type="button" onclick="closeModal()" class="inline-flex justify-center rounded-md border border-transparent bg-emart-orange px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-e68a00 focus:outline-none">
                    OK
                </button>
            </div>
        </div>
    </div>
    
    <!-- Toast Notification (Hidden by default) -->
    <div id="toast-message" class="hidden fixed top-4 right-4 z-50 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg opacity-0 transition-opacity duration-300">
        <!-- Message injected here -->
    </div>


    <!-- Main Container -->
    <div class="container mx-auto p-4 md:p-8 max-w-6xl">

        <h1 class="text-3xl md:text-4xl font-light text-gray-900 flex items-center mb-10 pb-4">
            <!-- Cart Icon SVG -->
            <svg class="w-8 h-8 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
            カートの内容
        </h1>
        
        <!-- Test Toggle Button -->
        <button id="test-toggle-button" class="mb-6 px-4 py-2 bg-gray-100 rounded-md text-sm text-gray-700 hover:bg-gray-200">
            >> Full Cart Preview (クリックして機能を確認)
        </button>

        <!-- EMPTY CART STATE -->
        <div id="empty-cart-message" class="flex justify-center items-center h-64 bg-gray-50 border border-dashed border-gray-300 rounded-lg hidden">
            <p class="text-xl font-medium text-gray-500 p-8">
                現在カートには何も入っていません
            </p>
        </div>

        <!-- FULL CART STATE (holds the two columns) -->
        <div id="full-cart-content" class="flex flex-col md:flex-row gap-8 hidden">
            
            <!-- Left Column: Cart Items Container -->
            <div id="cart-items-container" class="md:w-3/5 space-y-2">
                <!-- Product items are dynamically injected here by renderCart() -->
            </div>
            
            <!-- Right Column: Summary Panel -->
            <div class="md:w-2/5 p-6 bg-emart-summary-bg rounded-lg shadow-cart h-fit sticky top-8">
                <h2 class="text-xl font-semibold mb-4 text-gray-800">注文概要</h2>

                <div class="space-y-3 pb-6 border-b border-gray-300">
                    <div class="flex justify-between items-center text-gray-700">
                        <span class="text-base">選択された商品点数:</span>
                        <span id="summary-items" class="text-lg font-bold">0 点</span>
                    </div>
                    <div class="flex justify-between items-center text-gray-800 mt-4">
                        <span class="text-xl font-semibold">合計:</span>
                        <span id="summary-total" class="text-3xl font-extrabold text-gray-900">¥0</span>
                    </div>
                </div>
                
                <div class="mt-6">
                    <!-- Checkout Button: Calls handleCheckout() -->
                    <button id="checkout-button" onclick="handleCheckout()" class="w-full h-14 buy-button text-white text-xl font-bold rounded-lg flex items-center justify-center shadow-md disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        <!-- Shopping Cart Icon SVG for the button -->
                        <svg class="w-7 h-7 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path></svg>
                        購入
                    </button>
                </div>

                <p class="text-xs text-center text-gray-500 mt-4">
                    ※ 送料・手数料は、ご注文手続き時に計算されます。
                </p>
            </div>
        </div>
        
    </div>
</body>
</html>